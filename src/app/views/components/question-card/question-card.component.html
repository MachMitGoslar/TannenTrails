<ion-card class="question-card" *ngIf="question && showCard && !inRadius">
  <ion-card-header>
    <ion-card-title>
      <ion-icon name="help-circle-outline"></ion-icon>
      Aufgabe
      <span class="question-status" *ngIf="isAnswered" [class.correct]="showResult">
        <ion-icon [name]="showResult ? 'checkmark-circle' : 'close-circle'"></ion-icon>
      </span>
    </ion-card-title>
  </ion-card-header>
  
  <ion-card-content>
    <div class="question-content">
      <p class="question-text">{{ question.questionText }}</p>
      
      <!-- Multiple Choice Question -->
       @if(question.type === 'multiple-choice') {
      <div class="multiple-choice">
        <ion-radio-group [(ngModel)]="selectedAnswer" [disabled]="isAnswered">
          <ion-item *ngFor="let option of getQuestionOptions(); let i = index" 
                    lines="none" 
                    [class.selected]="selectedAnswer === i"
                    [class.correct-answer]="isAnswered && i === getCorrectOptionIndex() && selectedAnswer === i"
                    [class.wrong-answer]="isAnswered && selectedAnswer === i && i !== getCorrectOptionIndex()">
            <ion-radio slot="start" [value]="i" [disabled]="isAnswered"></ion-radio>
            <ion-label>{{ option }}</ion-label>
            @if(isAnswered && i === getCorrectOptionIndex() && selectedAnswer === i) {
              <ion-icon
                        name="checkmark" 
                        slot="end" 
                        color="success"></ion-icon>
            } 
            @else if(isAnswered && selectedAnswer === i && i !== getCorrectOptionIndex()) {
            <ion-icon
                      name="close" 
                      slot="end" 
                      color="danger"></ion-icon>
            }
            
          </ion-item>
        </ion-radio-group>
      </div>
    }

      <!-- True/False Question -->
      <div *ngIf="question.type === 'true-false'" class="true-false">
        <ion-radio-group [(ngModel)]="selectedAnswer" [disabled]="isAnswered">
          <ion-item lines="none" 
                    [class.selected]="selectedAnswer === true"
                    [class.correct-answer]="isAnswered && getCorrectAnswer() === true"
                    [class.wrong-answer]="isAnswered && selectedAnswer === true && getCorrectAnswer() !== true">
            <ion-radio slot="start" [value]="true"></ion-radio>
            <ion-label>Richtig</ion-label>
            <ion-icon *ngIf="isAnswered && getCorrectAnswer() === true" 
                      name="checkmark" 
                      slot="end" 
                      color="success"></ion-icon>
            <ion-icon *ngIf="isAnswered && selectedAnswer === true && getCorrectAnswer() !== true" 
                      name="close" 
                      slot="end" 
                      color="danger"></ion-icon>
          </ion-item>
          <ion-item lines="none" 
                    [class.selected]="selectedAnswer === false"
                    [class.correct-answer]="isAnswered && getCorrectAnswer() === false"
                    [class.wrong-answer]="isAnswered && selectedAnswer === false && getCorrectAnswer() !== false">
            <ion-radio slot="start" [value]="false"></ion-radio>
            <ion-label>Falsch</ion-label>
            <ion-icon *ngIf="isAnswered && getCorrectAnswer() === false" 
                      name="checkmark" 
                      slot="end" 
                      color="success"></ion-icon>
            <ion-icon *ngIf="isAnswered && selectedAnswer === false && getCorrectAnswer() !== false" 
                      name="close" 
                      slot="end" 
                      color="danger"></ion-icon>
          </ion-item>
        </ion-radio-group>
      </div>

      <!-- Estimation Question -->
      <div *ngIf="question.type === 'estimation'" class="estimation">
        <ion-item [class.correct-answer]="isAnswered && showResult" 
                  [class.wrong-answer]="isAnswered && !showResult">
          <ion-input 
            type="number" 
            [(ngModel)]="estimationInput"
            [disabled]="isAnswered"
            placeholder="Gib deine Schätzung ein...">
          </ion-input>
          <ion-icon *ngIf="isAnswered" 
                    [name]="showResult ? 'checkmark' : 'close'" 
                    slot="end" 
                    [color]="showResult ? 'success' : 'danger'"></ion-icon>
        </ion-item>
        
        <!-- Show correct answer and range for estimation -->
        <div *ngIf="isAnswered" class="estimation-result">
          <p class="correct-value">
            <strong>Richtige Antwort:</strong> {{ getCorrectValue() }}
            <span *ngIf="getMarginOfError() > 0">
              (± {{ getMarginOfError() }})
            </span>
          </p>
          <p class="your-answer" *ngIf="estimationInput !== null">
            <strong>Deine Antwort:</strong> {{ estimationInput }}
          </p>
        </div>
      </div>

      <!-- Submit Button -->
      <ion-button 
        expand="block" 
        [color]="isAnswered ? (showResult ? 'success' : 'danger') : 'primary'" 
        class="submit-button"
        [disabled]="!canSubmitAnswer() || isAnswered"
        (click)="submitAnswer()">
        <ion-icon 
          [name]="isAnswered ? (showResult ? 'checkmark-circle' : 'close-circle') : 'checkmark-circle-outline'" 
          slot="start">
        </ion-icon>
        <span *ngIf="!isAnswered">Antwort überprüfen</span>
        <span *ngIf="isAnswered && showResult">Richtig! Gut gemacht!</span>
        <span *ngIf="isAnswered && !showResult">Leider falsch. Versuche es nochmal!</span>
      </ion-button>

      <!-- Reset Button for answered questions -->
      <ion-button 
        *ngIf="isAnswered"
        expand="block" 
        fill="clear" 
        color="color-dark-100"
        class="reset-button"
        (click)="resetQuestion()">
        <ion-icon name="refresh" slot="start"></ion-icon>
        Nochmal versuchen
      </ion-button>

    </div>
  </ion-card-content>
</ion-card>